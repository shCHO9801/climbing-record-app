# Trouble Shooting
프로젝트를 진행하면서 발생한 문제점들과 해결법 서술합니다.

## POINT 타입 문제점
프로젝트를 진행하면서 공간 데이터를 저장하고 처리하기 위해 Point 타입을 사용하였습니다. 
그러나 이를 사용하면서 다음과 같은 문제점이 발생했습니다.
1. 문제점 설명
클라이밍장 생성 API를 통해 Point 타입의 위치 데이터를 JSON으로 직렬화 하거나 역질렬화하려고 시도할 때 다음과 같은 오류가 발생했습니다.

    ```text
    [Unhandled Exception] Type definition error: [simple type, class org.locationtech.jts.geom.Point]
    ```
    이 오류는 Jakson이 ```org.locationtech.jts.geom.Point``` 클래스를 올바르게 처리하지 못해 발생한 문제 였습니다.


2. 원인 분석
- **Jackson**의 기본 설정 문제: Jackson은 기본적으로 JTS ``Point`` 클래스를 인식하지 못하여 직렬화/역직렬화 시 오류가 발생했습니다.
- **의존성 버전 불일치**: 기존에 사용하던 ``jackson-datatype-jts:2.4``는 **Jackson 2.15**와 호환되지 않아 문제가 지속되었습니다.

3. 해결 방법
   - build.gradle 의존성 수정: jackson-datatype-jts:2.4 의존성을 제거하여 버전 불일치 문제를 해결했습니다.
   - 커스텀 Serializer 및 Deserializer 구현: Point 타입의 직렬화와 역직렬화를 처리하기 위해 커스텀 Serializer와 Deserializer를 구현했습니다.
   - Jackson 설정 추가: JacksonConfig.java 파일을 수정하여 커스텀 모듈을 등록하고 Jackson이 Point 타입을 올바르게 처리할 수 있도록 설정했습니다.
 
---

## H2 데이터베이스 문제 및 Testcontainers 도입
프로젝트 초기에는 테스트 환경에서 H2 인메모리 데이터베이스를 사용하여 빠른 테스트 실행을 목표로 설정하였습니다. 
그러나 ``Point`` 타입과 같은 공간 데이터를 처리하는 과정에서 다음과 같은 문제점들이 발생하면서 Testcontainers를 도입하게 되었습니다.
1. 문제점 설명
- H2와 실제 데이터베이스의 차이: H2는 개발 및 테스트 환경에서 빠른 속도를 제공하지만, 실제 운영 환경에서 사용하는 MySQL과는 일부 SQL 방언 및 기능 지원 면에서 차이가 있었습니다. 특히, 공간 데이터 처리와 관련된 기능에서 호환성 문제가 발생하였습니다.
- 공간 데이터 지원의 한계: H2는 JTS와 같은 공간 데이터 라이브러리를 완벽하게 지원하지 않아, 공간 데이터를 포함한 테스트 시 정확한 검증이 어려웠습니다.
- 테스트의 신뢰성 저하: H2의 제한된 기능으로 인해 실제 운영 환경과 동일한 조건에서의 테스트가 불가능해, 테스트 결과의 신뢰성이 떨어졌습니다.
2. 원인 분석
- H2의 기능 제한: H2는 인메모리 데이터베이스로서 빠른 테스트를 가능하게 하지만, MySQL과 같은 실제 데이터베이스가 제공하는 모든 기능을 지원하지는 않습니다. 특히, 공간 데이터 처리와 관련된 고급 기능에서 한계가 존재했습니다.
- JPA 및 Hibernate 설정 차이: H2와 MySQL 간의 JPA 및 Hibernate 설정 차이로 인해, 동일한 엔티티 매핑이 두 데이터베이스에서 다르게 동작할 수 있었습니다.
3. 해결 방법
- Testcontainers 도입: 실제 운영 환경과 동일한 MySQL 데이터베이스를 컨테이너로 실행하여 테스트 환경에서 사용함으로써, H2의 제한된 기능을 우회하고 보다 신뢰성 있는 테스트를 수행할 수 있게 되었습니다.
- 프로필 분리 및 설정: H2 기반 테스트와 Testcontainers 기반 테스트를 명확히 분리하기 위해, 두 가지 별도의 프로파일을 설정하였습니다. 이를 통해 상황에 따라 적절한 데이터베이스를 선택적으로 사용할 수 있게 되었습니다.
  - application-test-useContainers.yml: Testcontainers를 사용하여 MySQL 컨테이너 기반의 테스트 환경을 설정하였습니다.
  - application-test-useH2.yml: 기존의 H2 인메모리 데이터베이스를 사용한 테스트 환경을 유지하였습니다. 이 프로파일은 단순한 CRUD 테스트와 같이 빠른 테스트 실행이 필요한 경우에 유용합니다.
- 프로파일 활성화 방식: 테스트 시 특정 프로파일을 활성화하여, 필요한 데이터베이스 설정을 적용할 수 있도록 하였습니다. 예를 들어, 공간 데이터와 관련된 테스트에서는 testContainer 프로파일을 활성화하고, 그렇지 않은 경우에는 testH2 프로파일을 사용하도록 설정하였습니다.